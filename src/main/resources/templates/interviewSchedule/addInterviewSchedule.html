<!doctype html>
<html lang="en">
<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>


<div class="container-fluid">
    Interview Schedule
</div>
<div class="container-fluid">

    <div class="container">
        <form action="/interviewSchedule" method="post">
            <div class="container">
                <div class="com-6">
                    Total Applicant Count = <span data-th-text="${totalApplicantCount}" id="totalApplicantCount"></span>
                </div>
                <div class="com-6">
                    <div class="form-row">Interview Number =
                        <select class="form-control" name="interviewNumber">
                            <option value="">Please select</option>
                            <option data-th-each="interviewBoardNumber : ${interviewBoardNumbers}"
                                    data-th-value="${interviewBoardNumber}"
                                    data-th-text="${interviewBoardNumber.applicantStatus}"></option>
                        </select>
                    </div>
                </div>
            </div>
            <table class="table table-striped table-inverse table-responsive" id="interviewSchedule">
                <thead class="thead-inverse">
                <tr>
                    <th>Date</th>
                    <th>Interview Board Name</th>
                    <th>Applicant Count</th>
                    <th>Remaining Count</th>
                    <th>Modify</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><input type="date" class="form-control" name="interviewScheduleLists[0].date"></td>
                    <td>
                        <select class="form-control" name="interviewScheduleLists[0].interviewBoardId">
                            <option value="">Please select</option>
                            <option data-th-each="interviewBordOne : ${interviewBoard}"
                                    data-th-value="${interviewBordOne.id}"
                                    data-th-text="${interviewBordOne.name}"></option>
                        </select>
                    </td>
                    <td><input type="number" id="co0" onkeyup="countFind(this)" class="form-control count"
                               name="interviewScheduleLists[0].count"></td>
                    <td><input type="text" class="form-control" id="rm0" value="" readonly></td>
                    <td>
                        <button type="button" onclick="removeScheduleInterview(this)" class="btn btn-danger">Remove
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="form-group col-md-12 col-sm-12 text-center flex-column ">
                <button class="btn btn-info mr-5" type="button" id="newSchedule">New Schedule</button>
                <button class="btn btn-warning mr-5"
                        type="reset">
                    Clear
                </button>
                <button class="btn btn-success" type="submit">
                    <span data-th-text="${'Save'}"></span>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<footer data-th-replace="~{fragments/footerSection :: footerSectionFragment}"></footer>
<script data-th-replace="~{fragments/scriptSection :: scriptSectionFragment}"></script>

<script>

    $("#newSchedule").bind("click", function () {
        let rowLength = $('#interviewSchedule tbody > tr').length;
        let html = `<tr>
           <td scope="row"><input type="date" class="form-control" name="interviewScheduleLists[${rowLength}].date"></td>
           <td>
           <select class="form-control" name="interviewScheduleLists[${rowLength}].interviewBoardId">
            <option value="" >Please select</option >
            <option data-th-each="interviewBordOne : ${'${interviewBoard}" data-th-value="${interviewBordOne.id}"  data-th-text="${interviewBordOne.name}"'}></option >
          </select >
           </td>
           <td><input type="text" id="co${rowLength}" onkeyup="countFind(this)" class="form-control count" name="interviewScheduleLists[${rowLength}].count"></td>
           <td><input type="number" class="form-control count" value="" id="rm${rowLength}" readonly></td>
           <td> <button type="button" onclick="removeScheduleInterview(this)" class="btn btn-danger">Remove</button></td>
          </tr>`
        $('#interviewSchedule > tbody:last-child').append(html);
    });

    function removeScheduleInterview(obj) {
        document.getElementById("interviewSchedule").deleteRow(obj.parentNode.parentNode.rowIndex);
    }

    function countFind(obj) {
        let selectedFiledId = obj.getAttribute('id').slice(2);
        let totalCount = 0;
        let countArray = document.getElementsByClassName("count");
        for (let i = 0; i < countArray.length; i++) {
            console.log(countArray[i].value + " sdsdasdsada")
            totalCount += parseInt(countArray[i].value)
        }

        console.log(totalCount)
        let remainCount = parseInt(document.getElementById("totalApplicantCount").innerHTML) - totalCount;

        console.log(remainCount)
        if (remainCount > 0) {
            $(`#rm${selectedFiledId}`).val(remainCount);
        } else {
            swal({
                title: "Please count again",
                icon: "warning",
                text: "There is no more applicant to create new interview ",
            });
            $(`#rm${selectedFiledId}`).val(0);
        }
    }

</script>

</body>
</html>
